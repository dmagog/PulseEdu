# Excel Mapping - Описание импорта данных

Версия: v0.1 · Дата: 2025-09-08

## Содержание

1. [Общая информация](#общая-информация)
2. [Структура Excel файла](#структура-excel-файла)
3. [Маппинг полей](#маппинг-полей)
4. [Примеры файлов](#примеры-файлов)
5. [Валидация данных](#валидация-данных)
6. [Обработка ошибок](#обработка-ошибок)
7. [Частые проблемы](#частые-проблемы)

---

## Общая информация

Система PulseEdu поддерживает импорт данных из Excel файлов (.xlsx, .xls) для загрузки информации о студентах, курсах, посещаемости и оценках.

### Поддерживаемые форматы
- **Excel 2007+**: .xlsx
- **Excel 97-2003**: .xls
- **CSV**: .csv (с разделителем запятая)

### Ограничения
- Максимальный размер файла: 10MB
- Максимальное количество строк: 10,000
- Максимальное количество столбцов: 50

---

## Структура Excel файла

### Основные листы

Excel файл может содержать следующие листы:

1. **students** - информация о студентах
2. **courses** - информация о курсах  
3. **attendance** - посещаемость занятий
4. **grades** - оценки и задания
5. **tasks** - задания и дедлайны

### Обязательные поля

Каждый лист должен содержать определенные обязательные поля для корректной обработки.

---

## Маппинг полей

### Лист "students"

| Поле Excel | Алиас | Тип | Обязательное | Описание |
|------------|-------|-----|--------------|----------|
| `student_id` | `student_id` | string | ✅ | Уникальный ID студента |
| `name` | `full_name` | string | ✅ | Полное имя студента |
| `email` | `email` | string | ❌ | Email адрес |
| `group` | `group_name` | string | ❌ | Название группы |
| `phone` | `phone` | string | ❌ | Номер телефона |
| `created_date` | `created_at` | date | ❌ | Дата создания записи |

**Пример структуры:**
```
student_id | name           | email              | group
01         | Иванов И.И.    | ivanov@example.com | Группа 1
02         | Петров П.П.    | petrov@example.com | Группа 1
```

### Лист "courses"

| Поле Excel | Алиас | Тип | Обязательное | Описание |
|------------|-------|-----|--------------|----------|
| `course_id` | `course_id` | integer | ✅ | Уникальный ID курса |
| `name` | `course_name` | string | ✅ | Название курса |
| `description` | `description` | string | ❌ | Описание курса |
| `teacher` | `teacher_name` | string | ❌ | Имя преподавателя |
| `start_date` | `start_date` | date | ❌ | Дата начала курса |
| `end_date` | `end_date` | date | ❌ | Дата окончания курса |

**Пример структуры:**
```
course_id | name                    | description           | teacher
1         | Основы программирования | Базовый курс Python   | Смирнов А.А.
2         | Веб-разработка          | HTML, CSS, JavaScript | Козлов В.В.
```

### Лист "attendance"

| Поле Excel | Алиас | Тип | Обязательное | Описание |
|------------|-------|-----|--------------|----------|
| `student_id` | `student_id` | string | ✅ | ID студента |
| `course_id` | `course_id` | integer | ✅ | ID курса |
| `lesson_number` | `lesson_number` | integer | ✅ | Номер занятия |
| `attended` | `attended` | boolean | ✅ | Посещение (true/false) |
| `date` | `attendance_date` | date | ✅ | Дата занятия |
| `notes` | `notes` | string | ❌ | Заметки |

**Пример структуры:**
```
student_id | course_id | lesson_number | attended | date       | notes
01         | 1         | 1             | true     | 2024-01-15 | 
01         | 1         | 2             | false    | 2024-01-17 | Болел
02         | 1         | 1             | true     | 2024-01-15 |
```

### Лист "grades"

| Поле Excel | Алиас | Тип | Обязательное | Описание |
|------------|-------|-----|--------------|----------|
| `student_id` | `student_id` | string | ✅ | ID студента |
| `course_id` | `course_id` | integer | ✅ | ID курса |
| `task_name` | `task_name` | string | ✅ | Название задания |
| `grade` | `grade` | float | ❌ | Оценка (0-100) |
| `max_grade` | `max_grade` | float | ❌ | Максимальная оценка |
| `submitted_date` | `submitted_at` | date | ❌ | Дата сдачи |
| `deadline` | `deadline` | date | ❌ | Дедлайн |
| `status` | `status` | string | ❌ | Статус (pending/submitted/graded) |

**Пример структуры:**
```
student_id | course_id | task_name    | grade | max_grade | submitted_date | deadline   | status
01         | 1         | Домашнее 1   | 85    | 100       | 2024-01-20     | 2024-01-25 | graded
01         | 1         | Проект 1     | 90    | 100       | 2024-01-22     | 2024-01-30 | graded
02         | 1         | Домашнее 1   |       | 100       |                | 2024-01-25 | pending
```

### Лист "tasks"

| Поле Excel | Алиас | Тип | Обязательное | Описание |
|------------|-------|-----|--------------|----------|
| `course_id` | `course_id` | integer | ✅ | ID курса |
| `task_name` | `task_name` | string | ✅ | Название задания |
| `description` | `description` | string | ❌ | Описание задания |
| `deadline` | `deadline` | date | ✅ | Дедлайн |
| `max_grade` | `max_grade` | float | ❌ | Максимальная оценка |
| `task_type` | `task_type` | string | ❌ | Тип задания (homework/project/exam) |

**Пример структуры:**
```
course_id | task_name    | description        | deadline   | max_grade | task_type
1         | Домашнее 1   | Решить задачи 1-5  | 2024-01-25 | 100       | homework
1         | Проект 1     | Создать веб-сайт   | 2024-01-30 | 200       | project
1         | Экзамен 1    | Письменный экзамен | 2024-02-05 | 100       | exam
```

---

## Примеры файлов

### Минимальный файл студентов

**students.xlsx**
```
student_id | name
01         | Иванов Иван Иванович
02         | Петров Петр Петрович
03         | Сидоров Сидор Сидорович
```

### Полный файл с несколькими листами

**full_data.xlsx**

**Лист "students":**
```
student_id | name           | email              | group
01         | Иванов И.И.    | ivanov@example.com | Группа 1
02         | Петров П.П.    | petrov@example.com | Группа 1
03         | Сидоров С.С.   | sidorov@example.com| Группа 2
```

**Лист "courses":**
```
course_id | name                    | teacher
1         | Основы программирования | Смирнов А.А.
2         | Веб-разработка          | Козлов В.В.
```

**Лист "attendance":**
```
student_id | course_id | lesson_number | attended | date
01         | 1         | 1             | true     | 2024-01-15
01         | 1         | 2             | true     | 2024-01-17
02         | 1         | 1             | false    | 2024-01-15
02         | 1         | 2             | true     | 2024-01-17
```

**Лист "grades":**
```
student_id | course_id | task_name  | grade | deadline
01         | 1         | Домашнее 1 | 85    | 2024-01-25
01         | 1         | Проект 1   | 90    | 2024-01-30
02         | 1         | Домашнее 1 | 75    | 2024-01-25
```

### CSV файл

**students.csv**
```csv
student_id,name,email,group
01,"Иванов И.И.",ivanov@example.com,"Группа 1"
02,"Петров П.П.",petrov@example.com,"Группа 1"
03,"Сидоров С.С.",sidorov@example.com,"Группа 2"
```

---

## Валидация данных

### Правила валидации

1. **student_id**: 
   - Должен быть уникальным
   - Только буквы, цифры и подчеркивания
   - Максимум 20 символов

2. **email**:
   - Должен соответствовать формату email
   - Должен быть уникальным (если указан)

3. **course_id**:
   - Должен быть положительным целым числом
   - Должен существовать в системе

4. **grade**:
   - Должна быть числом от 0 до max_grade
   - Если не указана, считается как 0

5. **date**:
   - Должна быть в формате YYYY-MM-DD
   - Не может быть в будущем (для attendance)

6. **attended**:
   - Должно быть true/false, 1/0, или "да"/"нет"

### Примеры валидных значений

| Поле | Валидные значения |
|------|-------------------|
| `attended` | `true`, `false`, `1`, `0`, `"да"`, `"нет"`, `"yes"`, `"no"` |
| `grade` | `0`, `85.5`, `100`, `"85"` |
| `date` | `2024-01-15`, `15.01.2024`, `01/15/2024` |
| `email` | `user@example.com`, `test.email+tag@domain.co.uk` |

---

## Обработка ошибок

### Типы ошибок

1. **Ошибки формата файла**:
   - Неподдерживаемый формат
   - Поврежденный файл
   - Пустой файл

2. **Ошибки структуры**:
   - Отсутствующие обязательные столбцы
   - Неправильные названия листов
   - Дублирующиеся столбцы

3. **Ошибки данных**:
   - Неверный формат данных
   - Нарушение ограничений
   - Дублирующиеся записи

4. **Ошибки связей**:
   - Ссылки на несуществующие записи
   - Нарушение внешних ключей

### Формат отчета об ошибках

```json
{
  "job_id": "import_123",
  "status": "error",
  "total_rows": 100,
  "processed_rows": 85,
  "error_rows": 15,
  "errors": [
    {
      "row": 5,
      "sheet": "students",
      "field": "email",
      "value": "invalid-email",
      "message": "Invalid email format"
    },
    {
      "row": 12,
      "sheet": "attendance",
      "field": "student_id",
      "value": "999",
      "message": "Student not found"
    }
  ]
}
```

---

## Частые проблемы

### 1. "Column not found"

**Проблема**: Система не может найти ожидаемый столбец.

**Решение**: 
- Проверьте точное название столбца
- Убедитесь, что нет лишних пробелов
- Используйте правильный регистр

### 2. "Invalid date format"

**Проблема**: Дата в неправильном формате.

**Решение**:
- Используйте формат YYYY-MM-DD
- Проверьте разделители (точки, слеши)
- Убедитесь, что дата не в будущем

### 3. "Student not found"

**Проблема**: В attendance или grades ссылаются на несуществующего студента.

**Решение**:
- Сначала импортируйте лист "students"
- Проверьте правильность student_id
- Убедитесь в отсутствии опечаток

### 4. "Duplicate student_id"

**Проблема**: Дублирующиеся ID студентов.

**Решение**:
- Проверьте уникальность student_id
- Удалите дублирующиеся строки
- Используйте разные ID для разных студентов

### 5. "File too large"

**Проблема**: Файл превышает лимит размера.

**Решение**:
- Разбейте файл на части
- Удалите ненужные столбцы
- Сожмите файл

---

## Рекомендации

### Подготовка данных

1. **Проверьте данные** перед импортом
2. **Используйте шаблоны** для единообразия
3. **Создавайте резервные копии** исходных файлов
4. **Тестируйте на небольших файлах** перед массовым импортом

### Оптимизация

1. **Удаляйте пустые строки** и столбцы
2. **Используйте короткие названия** столбцов
3. **Группируйте данные** по типам в разные листы
4. **Проверяйте связи** между таблицами

### Мониторинг

1. **Проверяйте логи импорта** после загрузки
2. **Валидируйте результаты** в интерфейсе
3. **Исправляйте ошибки** и повторяйте импорт
4. **Ведите учет** импортированных файлов

---

## Поддержка

Для вопросов по импорту данных:
- Создавайте issues в репозитории
- Прикладывайте примеры проблемных файлов
- Указывайте версию Excel и операционную систему
- Изучайте [DevGuide](devguide.md) для технических деталей
